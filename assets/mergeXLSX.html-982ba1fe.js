const e=JSON.parse(`{"key":"v-3f9388b9","path":"/front-end/mergeXLSX.html","title":"前端导出合并一（XLSX）","lang":"zh-CN","frontmatter":{"title":"前端导出合并一（XLSX）","date":"2020-10-22T00:00:00.000Z","tag":["excel","merge"],"category":["vue"]},"headers":[],"git":{"createdTime":1666433633000,"updatedTime":1666534682000,"contributors":[{"name":"sharebravery","email":"sharebavery@gmail.com","commits":3}]},"readingTime":{"minutes":1.61,"words":482},"filePathRelative":"front-end/mergeXLSX.md","localizedDate":"2020年10月22日","excerpt":"<pre><code>业务需要，做了个前端导出，使用了XLSX，由于有部分数据长度不固定，所以合并范围需要动态计算。\\n后面需要调整样式，发现 XLSX 开源版本不支持，切换到国产 ExcelJS，并基于此封装了一个工具类\\nExcelJSuu（文章二）,封装简化了插件提供的函数，并可以根据页面渲染所需的相同树形数据结构直接\\n计算出合并范围，最后封装完整后只需要直接传入表头和表格数据即可。\\n</code></pre>\\n<div class=\\"language-text line-numbers-mode\\" data-ext=\\"text\\"><pre class=\\"language-text\\"><code>/**\\n *\\n * @param queryHeader 第一排表头数组\\n */\\nasync function exportTable(queryHeader = tableHeader1.value) {\\n  const header1 = queryHeader ?? ['学校', '考试', '考试时间', '年级', '班级', '科目', '考试总分'];\\n\\n  const header2 = ['学号', '姓名', '班级'];\\n\\n  const dynamic = ['分数', '联考排名', '学校排名', '班级排名'];\\n\\n  const headers: [headerRow1: string[], headerRow2: string[], headerRow2: string[]] = [\\n    [],\\n    [...header2],\\n    new Array(header2.length + 1),\\n  ];\\n  const [headerRow1, headerRow2, headerRow3] = headers;\\n\\n  const params = deepCopy(showScoreParams.value);\\n  params.limit = 100000000;\\n\\n  const { items } = await api.Internal.ScoreAnalysis.GetScoreRanking_PostAsync(params, []);\\n  if (items?.length == 0) return;\\n\\n  const [firstItem] = items;\\n\\n  firstItem.scoreDetail\\n    .map((e) =&gt; e.subjectName)\\n    .forEach((subjectName) =&gt; {\\n      headerRow2.push(...[subjectName, ...new Array(dynamic.length - 1)]);\\n    });\\n\\n  const interval = Math.floor(headerRow2.length / header1.length) - 1; // 间隔\\n\\n  header1.reduce((pre, cur) =&gt; {\\n    // pre.push(...[cur, ...new Array(interval)]);\\n    headerRow1.push(...[cur, ...new Array(interval)]);\\n    return pre;\\n  }, []);\\n\\n  for (let i = 0; i &lt; firstItem.scoreDetail.length; i++) {\\n    headerRow3.push(...dynamic);\\n  }\\n\\n  const sheet = items.reduce((pre, cur) =&gt; {\\n    const { studentName, internalStudentNumber, schoolName, className, examName } = cur.info;\\n\\n    const row: (string | number)[] = [internalStudentNumber, studentName, className];\\n\\n    cur.scoreDetail.forEach((item) =&gt; {\\n      const { subjectName, score, unionExamRanking, ranking, classRanking } = item;\\n\\n      row.push(...[score, unionExamRanking, ranking, classRanking]);\\n    });\\n\\n    pre.push(row);\\n\\n    return pre;\\n  }, []);\\n\\n  sheet.unshift(...headers);\\n\\n  const ws = utils.aoa_to_sheet(sheet);\\n\\n  /**\\n   * 构造固定列，无定数列表头所合并行列坐标范围\\n   */\\n  const headerRow1MG = rangeArray(0, headerRow1.length - 1).flatMap((num, i) =&gt; {\\n    if (i % (interval + 1) === 0) {\\n      return {\\n        s: { c: num, r: 0 },\\n        e: { c: num + interval, r: 0 },\\n      };\\n    }\\n    return [];\\n  });\\n\\n  const headerRow2MG = rangeArray(0, header2.length - 1).map((num) =&gt; ({\\n    s: { c: num, r: 1 },\\n    e: { c: num, r: 2 },\\n  }));\\n\\n  const headerRow2DynamicMG = rangeArray(header2.length, headerRow2.length).flatMap((num, i) =&gt; {\\n    if (i % dynamic.length === 0) {\\n      return {\\n        s: { c: num, r: 1 },\\n        e: { c: num + dynamic.length - 1, r: 1 },\\n      };\\n    }\\n    return [];\\n  });\\n\\n  ws['!merges'] = [...headerRow1MG, ...headerRow2MG.concat(headerRow2DynamicMG)];\\n\\n   ws['!cols'] = headerRow3.map((e) =&gt; ({ wpx: 120 }));\\n   ws['!rows'] = headerRow3.map((e) =&gt; ({ hpx: 32 }));\\n\\n   const wb = utils.book_new();\\n   utils.book_append_sheet(wb, ws, '显示成绩');\\n   writeFile(wb, '学生成绩信息.xlsx');\\n}\\n</code></pre><div class=\\"line-numbers\\" aria-hidden=\\"true\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>"}`);export{e as data};
