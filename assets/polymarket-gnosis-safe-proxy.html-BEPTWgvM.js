import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as t,o as n}from"./app-dlAKgt0M.js";const e="/assets/01-infographic-meta-transaction-CK3WgdVr.png",l="/assets/02-flowchart-auto-claim-loop-DO0lSIxL.png",r={};function h(p,s){return n(),a("div",null,[...s[0]||(s[0]=[t('<h1 id="polymarket-量化交易实战-三-gnosis-safe-自动化交易" tabindex="-1"><a class="header-anchor" href="#polymarket-量化交易实战-三-gnosis-safe-自动化交易"><span>Polymarket 量化交易实战（三）：Gnosis Safe 自动化交易</span></a></h1><p><strong>EOA 是给人类用的，Proxy 才是给机器人的。</strong></p><p>如果你坚持用 MetaMask（EOA）跑脚本，你会遇到三个死结：</p><ol><li><strong>Gas 爆炸</strong>：每笔赎回都要 0.01 Matic，高频策略的利润会被磨损殆尽。</li><li><strong>并发锁死</strong>：Nonce 机制强迫你串行交易，无法并发。</li><li><strong>操作繁琐</strong>：每次合并仓位都要手动签名。</li></ol><p>要突破这些限制，我们需要引入 <strong>Relayer（中继器）</strong>。</p><h4 id="_1-所谓-无-gas-其实是有人买单" tabindex="-1"><a class="header-anchor" href="#_1-所谓-无-gas-其实是有人买单"><span>1. 所谓“无 Gas”，其实是有人买单</span></a></h4><figure><img src="'+e+`" alt="Meta-Transaction Flow" tabindex="0" loading="lazy"><figcaption>Meta-Transaction Flow</figcaption></figure><p>Polymarket 的 &quot;Gasless Trading&quot; 并非魔法。它的本质是 <strong>Meta-Transaction（元交易）</strong>。</p><p>流程很简单：</p><ol><li><strong>你（User）</strong>：签一张“条子”（Intent），说我要买什么。</li><li><strong>Relayer</strong>：拿着条子，帮你在链上发起交易，并支付 Gas。</li><li><strong>Proxy</strong>：验证条子是你签的，然后执行操作。</li></ol><p>这种架构把“签名权”和“执行权”分离了。</p><p><strong>这就是为什么我们需要 Gnosis Safe：它让账户变成了可编程的合约。</strong></p><h4 id="_2-核心实战-自动赎回-auto-claim" tabindex="-1"><a class="header-anchor" href="#_2-核心实战-自动赎回-auto-claim"><span>2. 核心实战：自动赎回（Auto Claim）</span></a></h4><p>预测市场最麻烦的是结算。比赛结束了，你的钱还在合约里。手动点一千次？不可能。</p><p><strong>结算机制简介（UMA Optimistic Oracle）：</strong></p><ul><li>市场结果由 UMA 预言机确定，而非 Polymarket 官方</li><li>任何人可以提交结算提案（需 $750 USDC.e 保证金）</li><li>提案后有 2 小时争议期，无争议则自动生效</li><li>胜利方每份获得 $1.00，失败方归零</li></ul><p>我们需要一个 7x24 小时的收割机。</p><p><strong>第一步：告诉合约干什么（构建 Calldata）</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">def</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> _encode_redeem</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> collateral</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> condition_id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> index_sets</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 函数签名：redeemPositions</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 这就像是在写汇编，告诉 EVM 要调用哪个函数、传什么参数</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    signature </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;redeemPositions(address,bytes32,bytes32,uint256[])&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    selector </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> keccak</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">text</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">signature)[:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    payload </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> encode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;address&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;bytes32&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;bytes32&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;uint256[]&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">],</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        [</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">str</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(collateral), </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">bytes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">bytes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(condition_id), index_sets]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    )</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;0x&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (selector </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> payload).</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">hex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>第二步：包装成 Safe 交易</strong></p><p>有了 Calldata，我们需要把它交给 Relayer：</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 关键：这是一个 Meta-Transaction，而不是直接发上链</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">tx </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> SafeTransaction</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    to</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Config.</span><span style="--shiki-light:#383A42;--shiki-dark:#D19A66;">CTF_ADDRESS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    operation</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">OperationType.Call,</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    data</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">calldata,</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    value</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;0&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Relayer 帮我们上链</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">relayer.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">execute</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">([tx], </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">metadata</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;auto-claim&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-守护进程-收益过滤" tabindex="-1"><a class="header-anchor" href="#_3-守护进程-收益过滤"><span>3. 守护进程：收益过滤</span></a></h4><figure><img src="`+l+'" alt="Auto-Claim Worker Logic" tabindex="0" loading="lazy"><figcaption>Auto-Claim Worker Logic</figcaption></figure><p>有了原子能力，还需要一个大脑。</p><p>并不是所有仓位都值得马上赎回。如果赎回金额小于 Gas 成本（虽然是 Relayer 付，但也要讲武德），或者 API 暂时不可用，都需要策略。</p><p>我的 <code>_auto_claim_worker</code> 遵循以下逻辑：</p><ol><li><strong>巡检</strong>：每分钟扫描 <code>/positions?redeemable=true</code>。</li><li><strong>估算</strong>：链下计算 <code>Expected Payout</code>。</li><li><strong>防抖</strong>：失败后冷却 2 分钟，避免死循环攻击 Relayer。</li></ol><h4 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h4><p>通过 Gnosis Safe 和 Relayer，我们将原本需要人工点击、消耗 Gas 的链上操作，转化为了一段段静默运行的代码。</p><ul><li><strong>Proxy Wallet</strong> 解决了并发和可编程性。</li><li><strong>Relayer</strong> 解决了 Gas 成本。</li></ul><p>现在的机器人，已经有了<strong>大脑（策略）<strong>和</strong>钱包（Proxy）</strong>。但它的<strong>手速</strong>还不够快。</p><p>下一篇，我们将通过<strong>批量下单（Batch Orders）</strong>，把它的反应速度提升 10 倍。</p>',33)])])}const d=i(r,[["render",h]]),g=JSON.parse('{"path":"/web3/polymarket/polymarket-gnosis-safe-proxy.html","title":"Polymarket 量化交易实战（三）：Gnosis Safe 自动化交易","lang":"zh-CN","frontmatter":{"title":"Polymarket 量化交易实战（三）：Gnosis Safe 自动化交易","shortTitle":"Gnosis Safe 自动化交易","date":"2025-10-15T00:00:00.000Z","categories":["量化交易","Polymarket"],"tags":["Python","Web3"],"order":4,"cover":"/covers/polymarket/polymarket-gnosis-safe-proxy.png","description":"Polymarket 量化交易实战（三）：Gnosis Safe 自动化交易 EOA 是给人类用的，Proxy 才是给机器人的。 如果你坚持用 MetaMask（EOA）跑脚本，你会遇到三个死结： Gas 爆炸：每笔赎回都要 0.01 Matic，高频策略的利润会被磨损殆尽。 并发锁死：Nonce 机制强迫你串行交易，无法并发。 操作繁琐：每次合并仓位...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Polymarket 量化交易实战（三）：Gnosis Safe 自动化交易\\",\\"image\\":[\\"https://sharebravery.com/covers/polymarket/polymarket-gnosis-safe-proxy.png\\"],\\"datePublished\\":\\"2025-10-15T00:00:00.000Z\\",\\"dateModified\\":\\"2026-02-10T05:16:30.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"不辞远\\",\\"url\\":\\"https://github.com/sharebravery\\"}]}"],["meta",{"property":"og:url","content":"https://sharebravery.com/web3/polymarket/polymarket-gnosis-safe-proxy.html"}],["meta",{"property":"og:site_name","content":"不辞远的分享"}],["meta",{"property":"og:title","content":"Polymarket 量化交易实战（三）：Gnosis Safe 自动化交易"}],["meta",{"property":"og:description","content":"Polymarket 量化交易实战（三）：Gnosis Safe 自动化交易 EOA 是给人类用的，Proxy 才是给机器人的。 如果你坚持用 MetaMask（EOA）跑脚本，你会遇到三个死结： Gas 爆炸：每笔赎回都要 0.01 Matic，高频策略的利润会被磨损殆尽。 并发锁死：Nonce 机制强迫你串行交易，无法并发。 操作繁琐：每次合并仓位..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://sharebravery.com/covers/polymarket/polymarket-gnosis-safe-proxy.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2026-02-10T05:16:30.000Z"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://sharebravery.com/covers/polymarket/polymarket-gnosis-safe-proxy.png"}],["meta",{"name":"twitter:image:alt","content":"Polymarket 量化交易实战（三）：Gnosis Safe 自动化交易"}],["meta",{"property":"article:tag","content":"Web3"}],["meta",{"property":"article:tag","content":"Python"}],["meta",{"property":"article:published_time","content":"2025-10-15T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2026-02-10T05:16:30.000Z"}]]},"git":{"createdTime":1770437222000,"updatedTime":1770700590000,"contributors":[{"name":"sharebravery","username":"sharebravery","email":"sharebravery@gmail.com","commits":3,"url":"https://github.com/sharebravery"}]},"readingTime":{"minutes":2.71,"words":813},"filePathRelative":"web3/polymarket/polymarket-gnosis-safe-proxy.md","excerpt":"\\n<p><strong>EOA 是给人类用的，Proxy 才是给机器人的。</strong></p>\\n<p>如果你坚持用 MetaMask（EOA）跑脚本，你会遇到三个死结：</p>\\n<ol>\\n<li><strong>Gas 爆炸</strong>：每笔赎回都要 0.01 Matic，高频策略的利润会被磨损殆尽。</li>\\n<li><strong>并发锁死</strong>：Nonce 机制强迫你串行交易，无法并发。</li>\\n<li><strong>操作繁琐</strong>：每次合并仓位都要手动签名。</li>\\n</ol>\\n<p>要突破这些限制，我们需要引入 <strong>Relayer（中继器）</strong>。</p>","autoDesc":true}');export{d as comp,g as data};
