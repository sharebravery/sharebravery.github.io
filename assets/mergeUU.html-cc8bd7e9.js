const n=JSON.parse(`{"key":"v-b99965dc","path":"/front-end/mergeUU.html","title":"前端导出合并二（ExcelJSuu）","lang":"zh-CN","frontmatter":{"title":"前端导出合并二（ExcelJSuu）","date":"2020-10-22T00:00:00.000Z","tag":["excel","merge"],"category":["vue"]},"headers":[],"git":{"createdTime":1666433633000,"updatedTime":1666534682000,"contributors":[{"name":"sharebravery","email":"sharebavery@gmail.com","commits":3}]},"readingTime":{"minutes":2.84,"words":851},"filePathRelative":"front-end/mergeUU.md","localizedDate":"2020年10月22日","excerpt":"<pre><code>基于国产ExcelJS封装的一个工具类，简化原有的函数操作。\\n</code></pre>\\n<div class=\\"language-text line-numbers-mode\\" data-ext=\\"text\\"><pre class=\\"language-text\\"><code>export class ExcelJSuu {\\n  constructor(public worksheet: Worksheet) {}\\n\\n  calcHeaders = calcHeaders;\\n\\n  flatCells = flatCells;\\n\\n  flatColumns = flatColumns;\\n\\n  ColumnCount = 0;\\n\\n  /**\\n   *根据间隔构造排及其合并数据\\n   *\\n   * @param {string[]} row\\n   * @param {number} interval\\n   * @return {*}  {{ row: string[][]; merges: Range[] }}\\n   * @memberof ExcelJSuu\\n   */\\n  buildRowAndMergesByInterval(row: string[], interval: number): { row: string[][]; merges: Range[] } {\\n    const newRow = row.reduce((pre, cur) =&gt; {\\n      if (pre.length + 1 == row.length * interval) {\\n        pre.push(cur);\\n      } else {\\n        pre.push(...[cur, ...new Array(interval)]);\\n      }\\n      return pre;\\n    }, []);\\n\\n    const merges = rangeArray(1, newRow.length)\\n      .map((num, i) =&gt; {\\n        if (i % (interval + 1) === 0) {\\n          return [1, num, 1, num + interval];\\n        }\\n        return [];\\n      })\\n      .filter((e) =&gt; e.length !== 0) as Range[];\\n\\n    return {\\n      row: newRow,\\n      merges,\\n    };\\n  }\\n\\n  /**\\n   *构建表头\\n   *\\n   * @param {IUuColumn[]} columns\\n   * @return {*}  {string[][]}\\n   * @memberof ExcelJSuu\\n   */\\n  buildHeadersAndMerges(columns: IUuColumn[]): { headers: string[][]; merges: Range[] } {\\n    const m = calcHeaders(columns);\\n\\n    const mgs = new Array(...m.values()).map((e) =&gt; [e.top, e.left, e.bottom, e.right] as Range);\\n\\n    return {\\n      headers: flatCells(m),\\n      merges: mgs,\\n    };\\n  }\\n\\n  /**\\n   *构建sheet二维数据结构\\n   *\\n   * @param {IUuTableColumnsType} flatColumns\\n   * @param {any[]} tableData\\n   * @return {*}  {string[][]}\\n   * @memberof ExcelJSuu\\n   */\\n  buildSheet(columns: IUuTableColumnsType, tableData: any[]): string[][] {\\n    const flats = flatColumns(columns);\\n\\n    return tableData.reduce((pre, cur) =&gt; {\\n      const arr = [];\\n      flats.forEach((column) =&gt; {\\n        arr.push(cur[column.dataIndex]);\\n      });\\n      pre.push(arr);\\n      return pre;\\n    }, []);\\n  }\\n\\n  /**\\n   *根据数据构建基本带边框的表格\\n   *\\n   * @param {IUuTableColumnsType} columns\\n   * @param {any[]} tableData\\n   * @return {*}  {string[][]}\\n   * @memberof ExcelJSuu\\n   */\\n  buildBaseSheet(columns: IUuTableColumnsType, tableData: any[], autoMerge = true): string[][] {\\n    const headersAndMgs = this.buildHeadersAndMerges(columns);\\n\\n    const sheet = this.buildSheet(columns, tableData);\\n\\n    sheet.unshift(...headersAndMgs.headers);\\n\\n    this.worksheet.addRows(sheet);\\n\\n    autoMerge &amp;&amp; this.merges(headersAndMgs.merges);\\n\\n    this.setWidthByColumns(columns);\\n\\n    this.setDefaultStyleByColumn(1, this.worksheet.columnCount);\\n\\n    return sheet;\\n  }\\n\\n  /**\\n   *合并单元格\\n   *\\n   * @param {MergeCells} v\\n   * @memberof ExcelJSuu\\n   */\\n  merges(v: ([top: number, left: number, bottom: number, right: number] | number[])[]): void {\\n    v.forEach((item) =&gt; {\\n      this.worksheet.mergeCells(item as [top: number, left: number, bottom: number, right: number]);\\n    });\\n  }\\n\\n  /**\\n   *根据columns的width属性调整表格宽度\\n   *\\n   * @param {IUuTableColumnsType} columns\\n   * @memberof ExcelJSuu\\n   */\\n  setWidthByColumns(columns: IUuTableColumnsType) {\\n    const flats = flatColumns(columns);\\n    flats.forEach((column, index) =&gt; {\\n      this.worksheet.getColumn(index + 1).width = column.width / 5;\\n    });\\n  }\\n\\n  /**\\n   *设置指定范围填充\\n   *\\n   * @param {number} top\\n   * @param {number} left\\n   * @param {number} bottom\\n   * @param {number} right\\n   * @param {Fill} fill\\n   * @memberof ExcelJSuu\\n   */\\n  setFillByRange(top: number, left: number, bottom: number, right: number, fill: Fill) {\\n    const rows = this.worksheet.getRows(top, bottom);\\n    rangeArray(left, right).forEach((num) =&gt; {\\n      rows.forEach((row) =&gt; {\\n        row.getCell(num).fill = fill;\\n      });\\n    });\\n  }\\n\\n  /**\\n   *设置默认样式 边框 居中\\n   *\\n   * @param {number} start\\n   * @param {number} end\\n   * @param {object} style\\n   * @memberof ExcelJSuu\\n   */\\n  setDefaultStyleByColumn(start: number, end: number, style?: Partial&lt;Style&gt;) {\\n    rangeArray(start, end).forEach((num) =&gt; {\\n      const column = this.worksheet.getColumn(num);\\n\\n      column.eachCell(function (cell, rowNumber) {\\n        cell.border = {\\n          top: { style: 'thin', color: { argb: 'ff000000' } },\\n          left: { style: 'thin', color: { argb: 'ff000000' } },\\n          bottom: { style: 'thin', color: { argb: 'ff000000' } },\\n          right: { style: 'thin', color: { argb: 'ff000000' } },\\n        };\\n        cell.alignment = { vertical: 'middle', horizontal: 'center' };\\n\\n        for (const key in style) {\\n          cell[key] = style[key];\\n        }\\n      });\\n    });\\n  }\\n\\n  /**\\n   *设置宽高\\n   *\\n   * @param {number} start\\n   * @param {number} end\\n   * @param {number} width\\n   * @param {number} height\\n   * @memberof ExcelJSuu\\n   */\\n  setWidthAndHeight(start: number, end: number, width: number, height: number) {\\n    rangeArray(start, end).forEach((num) =&gt; {\\n      const column = this.worksheet.getColumn(num);\\n\\n      column.width = width;\\n    });\\n\\n    const rows = this.worksheet.getRows(start, end);\\n\\n    rows.forEach((row) =&gt; {\\n      row.height = height;\\n    });\\n  }\\n\\n  /**\\n   *获取当前范围的列\\n   *\\n   * @param {number} start\\n   * @param {number} end\\n   * @return {*}\\n   * @memberof ExcelJSuu\\n   */\\n  getRangeByColumn(start: number, end: number) {\\n    return rangeArray(start, end).flatMap((num) =&gt; {\\n      const column = this.worksheet.getColumn(num);\\n      return [column];\\n    });\\n  }\\n\\n  /**\\n   *根据列来设置当前范围的样式\\n   *\\n   * @param {number} start\\n   * @param {number} end\\n   * @param {object} [style]\\n   * @memberof ExcelJSuu\\n   */\\n  setStyleInViewByColumn(start: number, end: number, style?: Partial&lt;Style&gt;): void {\\n    rangeArray(start, end).forEach((num) =&gt; {\\n      const column = this.worksheet.getColumn(num);\\n      column.eachCell(function (cell, rowNumber) {\\n        for (const key in style) {\\n          cell[key] = style[key];\\n        }\\n      });\\n    });\\n  }\\n\\n  /**\\n   *写入XLSX文件\\n   *\\n   * @param {Workbook} workbook\\n   * @memberof ExcelJSuu\\n   */\\n  async writeXLSXFile(workbook: Workbook, filename = this.worksheet.name): Promise&lt;void&gt; {\\n    const buffer = await workbook.xlsx.writeBuffer();\\n    const blob = new Blob([buffer], { type: 'application/octet-stream' });\\n\\n    openDownloadDialog(blob, filename);\\n  }\\n\\n  /**\\n   *将row插入工作簿流 不会破坏原有的结构 并返回新的工作簿\\n   *\\n   * @param {Workbook} workbook\\n   * @param {number} pos\\n   * @param {any[]} values\\n   * @return {*}  {Promise&lt;Workbook&gt;}\\n   * @memberof ExcelJSuu\\n   */\\n  async insertRowWithBuffer(workbook: Workbook, pos: number, values: any[]): Promise&lt;Workbook&gt; {\\n    const buffer = await workbook.xlsx.writeBuffer();\\n\\n    const newWb = await workbook.xlsx.load(buffer);\\n\\n    const worksheet = newWb.worksheets.find((e) =&gt; e.name === this.worksheet.name);\\n\\n    if (!worksheet) {\\n      console.warn('找不到工作表');\\n      return;\\n    }\\n\\n    worksheet.insertRow(pos, values);\\n\\n    return newWb;\\n  }\\n}\\n</code></pre><div class=\\"line-numbers\\" aria-hidden=\\"true\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>"}`);export{n as data};
